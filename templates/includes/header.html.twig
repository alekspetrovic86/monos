{# HEADER #}
<header class="header" id="site-header">
    <div class="nav-logo">
        <a href="{{ sulu_content_root_path('/') }}" data-action="click->remove-scroll-memory#clear">Monos.</a>
    </div>

    <nav class="header__nav" aria-label="Primary">
        <div class="d-block d-md-none text-end">
            <div class="locales">
                {% for localization in localizations %}
                    {% if localization.locale != app.request.locale %}

                        {% if localization.locale == 'en' %}
                            {% set label = 'en' %}
                        {% elseif localization.locale == 'sr' %}
                            {% set label = 'sr' %}
                        {% endif %}

                        <a href="{{ localization.url }}" class="footer__lang-link">
                            {{ label }}
                        </a>

                    {% endif %}
                {% endfor %}
            </div>
        </div>

        {# ------------------- #}
        {# Navigation tree      #}
        {# ------------------- #}
        {% set navTree = sulu_navigation_root_tree('main', 2, true) %}
        {% set activeParent = null %}
        {% set activeSecondLevel = null %}

        {# ------------------- #}
        {# Detect active child or grandchild #}
        {# ------------------- #}
        {% for parent in navTree %}
            {% for child in parent.children %}
                {% if sulu_navigation_is_active(request.resourceLocator, child.url) %}
                    {% set activeParent = parent %}
                    {% set activeSecondLevel = child %}
                {% endif %}

                {% if child.children is defined %}
                    {% for grandchild in child.children %}
                        {% if sulu_navigation_is_active(request.resourceLocator, grandchild.url) %}
                            {% set activeParent = parent %}
                            {% set activeSecondLevel = child %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            {% endfor %}
        {% endfor %}

        <div class="menu-wrapper">

            {# ------------------- #}
            {# MOBILE: Show second-level menu if child/grandchild active #}
            {# ------------------- #}
            {% if activeSecondLevel %}
                <ul class="nav-mob-second d-block d-md-none">
                    {% for item in activeParent.children %}
                        {% set itemUrl = sulu_content_path(item.url, item.webspaceKey) %}
                        {% set isActive = sulu_navigation_is_active(request.resourceLocator, item.url) %}
                        <li class="nav-item-mob">
                            <a href="{{ itemUrl }}" class="{{ isActive ? 'active nav-item-active' : '' }}" data-action="click->remove-scroll-memory#clear">
                                {{ item.title|default }}
                            </a>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

            {# ------------------- #}
            {# MOBILE: Main nav always visible, mark parent active if any child/grandchild is active #}
            {# ------------------- #}
            <ul class="nav-mob-main d-block d-md-none">
                {% for parent in navTree %}
                    {% set parentUrl = sulu_content_path(parent.url, parent.webspaceKey) %}
                    {% set isActiveParent = sulu_navigation_is_active(request.resourceLocator, parent.url) %}

                    {# If any child or grandchild is active, parent becomes active #}
                    {% for child in parent.children %}
                        {% if sulu_navigation_is_active(request.resourceLocator, child.url) %}
                            {% set isActiveParent = true %}
                        {% endif %}
                        {% if child.children is defined %}
                            {% for grandchild in child.children %}
                                {% if sulu_navigation_is_active(request.resourceLocator, grandchild.url) %}
                                    {% set isActiveParent = true %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    {% endfor %}

                    <li class="nav-item-mob">
                        <a href="{{ parentUrl }}" class="{{ isActiveParent ? 'active nav-item-active' : '' }}" data-action="click->remove-scroll-memory#clear">
                            {{ parent.title|default }}
                        </a>
                    </li>
                {% endfor %}
            </ul>

            {# ------------------- #}
            {# DESKTOP #}
            {# ------------------- #}
            <ul class="nav-desk d-none d-md-flex">
                {% for parent in sulu_navigation_root_tree('main', 2, true) %}
                    {% set parentUrl = sulu_content_path(parent.url, parent.webspaceKey) %}

                    {# Detect if parent itself is active #}
                    {% set isActiveParent = sulu_navigation_is_active(request.resourceLocator, parent.url) %}

                    {# Detect active child or grandchild #}
                    {% for child in parent.children %}
                        {% if sulu_navigation_is_active(request.resourceLocator, child.url) %}
                            {% set isActiveParent = true %}
                        {% endif %}

                        {% if child.children is defined %}
                            {% for grandchild in child.children %}
                                {% if sulu_navigation_is_active(request.resourceLocator, grandchild.url) %}
                                    {% set isActiveParent = true %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    {% endfor %}

                    <li class="nav-item">
                        <a href="{{ parentUrl }}" class="{{ isActiveParent ? 'active nav-item-active' : '' }}" data-action="click->remove-scroll-memory#clear">
                            {{ parent.title|default }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    </nav>
</header>
